DROP TABLE BoltStock CASCADE CONSTRAINTS; 
DROP TABLE CurrentPrice CASCADE CONSTRAINTS; 
DROP TABLE Customer CASCADE CONSTRAINTS; 
DROP TABLE CustomerPhoneNo CASCADE CONSTRAINTS; 
DROP TABLE Employee CASCADE CONSTRAINTS; 
DROP TABLE OrderList CASCADE CONSTRAINTS; 
DROP TABLE Supplier CASCADE CONSTRAINTS; 
DROP TABLE FabricCategory CASCADE CONSTRAINTS; 
DROP TABLE PartialPayment CASCADE CONSTRAINTS; 
DROP TABLE SupplierPhoneNo CASCADE CONSTRAINTS; 

CREATE TABLE FabricCategory(
    FabricCode VARCHAR(10) NOT NULL PRIMARY KEY,
    FabricName VARCHAR(20) NOT NULL,
    Quantity INT NOT NULL,
    Color VARCHAR(20)
);

CREATE TABLE CurrentPrice(
    FabricCode VARCHAR(10) NOT NULL,
    Price FLOAT NOT NULL,
    PricedTime DATE NOT NULL,
    PRIMARY KEY (FabricCode, Price, PricedTime),
    CONSTRAINT fk_currentPrice_fabricCode FOREIGN KEY (FabricCode) REFERENCES FabricCategory(FabricCode)
    ON DELETE SET NULL DEFERRABLE
);

CREATE TABLE Employee(
    EmployeeCode VARCHAR(10) NOT NULL PRIMARY KEY,
    FName VARCHAR(10) NOT NULL,
    LName VARCHAR(10) NOT NULL,
    Address VARCHAR(50) NOT NULL,
    PhoneNo INT UNIQUE NOT NULL,
    Gender VARCHAR(10) NOT NULL,
    JobType VARCHAR(20) NOT NULL
);

--For supplier, referencing employee
CREATE TABLE Supplier(
    SupplierCode VARCHAR(10) NOT NULL PRIMARY KEY,
    Address VARCHAR(50) NOT NULL,
    Name VARCHAR(20) NOT NULL,
    TaxCode VARCHAR(20) NOT NULL UNIQUE,
    BankAccount VARCHAR(30) NOT NULL UNIQUE,
    SuperEmployeeCode VARCHAR(10) NOT NULL,
    CONSTRAINT fk_supplier_superEmployeeCode FOREIGN KEY (SuperEmployeeCode) REFERENCES Employee(EmployeeCode)
    ON DELETE SET NULL DEFERRABLE
);

CREATE TABLE SupplierPhoneNo(
    ESupplierCode VARCHAR(10) NOT NULL,
    PhoneNo INT NOT NULL UNIQUE,
    PRIMARY KEY (ESupplierCode, PhoneNo),
    CONSTRAINT fk_supplierPhone_supplierCode FOREIGN KEY (ESupplierCode) REFERENCES Supplier(SupplierCode)
    ON DELETE SET NULL DEFERRABLE
);

-- For customer, referencing employee
CREATE TABLE Customer(
    CustomerCode VARCHAR(10) NOT NULL PRIMARY KEY,
    FName VARCHAR(10) NOT NULL,
    LName VARCHAR(10) NOT NULL,
    Address VARCHAR(50) NOT NULL,
    SuperEmployeeCode VARCHAR(10) NOT NULL,
    IsWarningMode VARCHAR(10) NOT NULL,
    Arrearage FLOAT NOT NULL,
    ArrearageTimeExist INT NOT NULL,
    IsBadDebt VARCHAR(10) NOT NULL,    
    CONSTRAINT fk_customer_superEmployeeCode FOREIGN KEY (SuperEmployeeCode) REFERENCES Employee(EmployeeCode)
    ON DELETE SET NULL DEFERRABLE
);

CREATE TABLE CustomerPhoneNo(
    ECustomerCode VARCHAR(10) NOT NULL,
    PhoneNo INT NOT NULL UNIQUE,
    PRIMARY KEY (ECustomerCode, PhoneNo),
    CONSTRAINT fk_customerPhone_customerCode FOREIGN KEY (ECustomerCode) REFERENCES Customer(CustomerCode)
    ON DELETE SET NULL DEFERRABLE
);

CREATE TABLE PartialPayment(
    ECustomerCode VARCHAR(10) NOT NULL,
    PaymentDate DATE NOT NULL ,
    Amount FLOAT NOT NULL,
    PRIMARY KEY (ECustomerCode, PaymentDate, Amount),
    CONSTRAINT fk_parPayment_customerCode FOREIGN KEY (ECustomerCode) REFERENCES Customer(CustomerCode)
    ON DELETE SET NULL DEFERRABLE
);

-- For Orderlist, referencing customer and employee
CREATE TABLE OrderList(
    OrderCode VARCHAR(10) NOT NULL PRIMARY KEY,
    OrderCustomerCode VARCHAR(10) NOT NULL,
    TotalPrice FLOAT NOT NULL,
    ProcessEmployeeCode VARCHAR(10) NOT NULL,
    ProcessDate DATE NOT NULL,
    OrderStatus VARCHAR(20) NOT NULL,
    IsCancelled VARCHAR(10),
    CancelReason VARCHAR(50),
    CONSTRAINT fk_order_customerCode FOREIGN KEY (OrderCustomerCode) REFERENCES Customer(CustomerCode)
    ON DELETE SET NULL DEFERRABLE,
    CONSTRAINT fk_order_empCode FOREIGN KEY (ProcessEmployeeCode) REFERENCES Employee(EmployeeCode)
    ON DELETE SET NULL DEFERRABLE
);

--For boltstock, referencing fabriccategory and orderlist
CREATE TABLE BoltStock(
    BoltCode VARCHAR(10) NOT NULL PRIMARY KEY,
    CategoryCode VARCHAR(10) NOT NULL,
    Length int NOT NULL,
    ContainInOrderCode VARCHAR(10),
    ESupplierCode VARCHAR(10) NOT NULL,
    DateImported DATE NOT NULL,
    Quantity int NOT NULL,
    PurchasePrice FLOAT NOT NULL,
    CONSTRAINT fk_boltStock_categoryCode FOREIGN KEY (CategoryCode) REFERENCES FabricCategory(FabricCode)
    ON DELETE SET NULL DEFERRABLE,
    CONSTRAINT fk_boltStock_containOrderCode FOREIGN KEY (ContainInOrderCode) REFERENCES OrderList(OrderCode)
    ON DELETE SET NULL DEFERRABLE
);

-- Insert data --
ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MM-YYYY';

INSERT INTO EMPLOYEE VALUES ('E001', 'An', 'Vo Hoang', 'HCMC', 0914077077, 'FEMALE', 'Operational Staff');
INSERT INTO EMPLOYEE VALUES ('E002', 'Duc', 'Nguyen Anh', 'HCMC', 0945454212, 'MALE', 'Office Staff');
INSERT INTO EMPLOYEE VALUES ('E003', 'Hoang', 'Tran', 'HCMC', 0973123391, 'MALE', 'Office Staff');
INSERT INTO EMPLOYEE VALUES ('E004', 'Khang', 'Nham Hoang', 'HCMC', 0962911119, 'MALE', 'Manager');
INSERT INTO EMPLOYEE VALUES ('E005', 'Thanh', 'Le Nhat', 'HCMC', 0936129765, 'FEMALE', 'Partner Staff');

INSERT INTO CUSTOMER VALUES ('CC001', 'Binh', 'Le Anh', 'HCMC', 'E004', 'NO', 1000, 0, 'NO');
INSERT INTO CUSTOMER VALUES ('CC002', 'Dung', 'Huynh Anh', 'Da Nang', 'E002', 'NO', 0, 0, 'NO');
INSERT INTO CUSTOMER VALUES ('CC003', 'Hang', 'Phan Thi', 'Ha Noi', 'E001', 'YES', 1250, 181, 'NO');
INSERT INTO CUSTOMER VALUES ('CC004', 'Linh', 'Nguyen Thi', 'Dong Nai', 'E005', 'NO', 3000, 35, 'YES');
INSERT INTO CUSTOMER VALUES ('CC005', 'Uyen', 'Pham Thanh', 'Long An', 'E003', 'NO', 0, 0, 'NO');

INSERT INTO PARTIALPAYMENT VALUES ('CC001', '13-03-2018', 400);
INSERT INTO PARTIALPAYMENT VALUES ('CC001', '13-09-2018', 1000);
INSERT INTO PARTIALPAYMENT VALUES ('CC002', '30-03-2019', 500.45);
INSERT INTO PARTIALPAYMENT VALUES ('CC003', '28-01-2020', 150);
INSERT INTO PARTIALPAYMENT VALUES ('CC005', '19-04-2021', 4000);

INSERT INTO CUSTOMERPHONENO VALUES ('CC001', 0915055055);
INSERT INTO CUSTOMERPHONENO VALUES ('CC002', 0982177277);
INSERT INTO CUSTOMERPHONENO VALUES ('CC003', 0127488889);
INSERT INTO CUSTOMERPHONENO VALUES ('CC004', 0813921921);
INSERT INTO CUSTOMERPHONENO VALUES ('CC005', 0852696969);
INSERT INTO CUSTOMERPHONENO VALUES ('CC003', 0911384351);

INSERT INTO SUPPLIER VALUES ('S001', '501 Hai Ba Trung, HA NOI', 'Cotton Agency', '33250', '131531000001', 'E001');
INSERT INTO SUPPLIER VALUES ('S002', '1028 Hoang Quoc Viet, HA NOI', 'Wool Agency', '13842', '146484000001', 'E002');
INSERT INTO SUPPLIER VALUES ('S003', '65 Hau Giang, HA NOI', 'Demin Agency', '51348', '131654000001', 'E003');
INSERT INTO SUPPLIER VALUES ('S004', '342/14A Ta Quang Buu, HA NOI', 'Velvet Agency', '13510', '134865000003', 'E003');
INSERT INTO SUPPLIER VALUES ('S005', '301 Tran Nguyen Han, DA NANG', 'Silk Agency', '46813', '138946000003', 'E004');
INSERT INTO SUPPLIER VALUES ('S006', '120 Phan Dang Luu, HCMC', 'Misc. Agency', '17426', '766413000004', 'E005');

INSERT INTO SUPPLIERPHONENO VALUES ('S001', '0710441394');
INSERT INTO SUPPLIERPHONENO VALUES ('S001', '0615953918');
INSERT INTO SUPPLIERPHONENO VALUES ('S002', '0162001266');
INSERT INTO SUPPLIERPHONENO VALUES ('S003', '0134856483');
INSERT INTO SUPPLIERPHONENO VALUES ('S003', '0135464683');
INSERT INTO SUPPLIERPHONENO VALUES ('S004', '0646486252');
INSERT INTO SUPPLIERPHONENO VALUES ('S005', '0133468453');
INSERT INTO SUPPLIERPHONENO VALUES ('S005', '0846513153');
INSERT INTO SUPPLIERPHONENO VALUES ('S005', '0456485372');
INSERT INTO SUPPLIERPHONENO VALUES ('S006', '0846551324');

INSERT INTO FABRICCATEGORY VALUES ('FC001', 'Cotton', 1, 'White');
INSERT INTO FABRICCATEGORY VALUES ('FC002', 'Wool', 1, 'Blue');
INSERT INTO FABRICCATEGORY VALUES ('FC003', 'Demin', 2, 'Dark Blue');
INSERT INTO FABRICCATEGORY VALUES ('FC004', 'Velvet', 1, 'Velvet');
INSERT INTO FABRICCATEGORY VALUES ('FC005', 'Silk', 1, 'Silk');

INSERT INTO CURRENTPRICE VALUES ('FC001', 10, '10-02-2019');
INSERT INTO CURRENTPRICE VALUES ('FC002', 30, '11-09-2019');
INSERT INTO CURRENTPRICE VALUES ('FC005', 30, '29-04-2020');
INSERT INTO CURRENTPRICE VALUES ('FC004', 15, '15-12-2020');
INSERT INTO CURRENTPRICE VALUES ('FC003', 50, '01-01-2021');
INSERT INTO CURRENTPRICE VALUES ('FC002', 30, '15-04-2021');
INSERT INTO CURRENTPRICE VALUES ('FC005', 25, '04-06-2021');
INSERT INTO CURRENTPRICE VALUES ('FC005', 40, '04-10-2021');

INSERT INTO ORDERLIST VALUES ('X001', 'CC001', 351.1, 'E001', '21-08-2019', 'FULL PAID', 'NO', ' ');
INSERT INTO ORDERLIST VALUES ('X002', 'CC001', 105, 'E003', '01-09-2020', 'FULL PAID', 'NO',' ' );
INSERT INTO ORDERLIST VALUES ('X003', 'CC002', 165.4, 'E005', '05-09-2020', 'CANCELLED', 'YES', 'Expensive!!');
INSERT INTO ORDERLIST VALUES ('X004', 'CC005', 255, 'E002', '30-03-2021', 'PARTIAL PAID', 'NO', ' ');
INSERT INTO ORDERLIST VALUES ('X005', 'CC003', 300, 'E002', '01-08-2021', 'ORDERED', 'NO', ' ');
INSERT INTO ORDERLIST VALUES ('X006', 'CC004', 400, 'E004', '30-10-2021', 'NEW', 'NO', ' ');

INSERT INTO BOLTSTOCK VALUES ('BC101', 'FC001', 20, 'X001', 'S001', '15-01-2019', 10, 400);
INSERT INTO BOLTSTOCK VALUES ('BC201', 'FC002', 30, 'X002', 'S002', '23-05-2019', 30, 315.1);
INSERT INTO BOLTSTOCK (BoltCode, CategoryCode, Length, ESupplierCode, DateImported, Quantity, PurchasePrice)
    VALUES ('BC301', 'FC003', 20, 'S003', '12-12-2019', 15, 105);
INSERT INTO BOLTSTOCK VALUES ('BC401', 'FC004', 40, 'X003', 'S004', '21-01-2020', 50, 124.5);
INSERT INTO BOLTSTOCK VALUES ('BC501', 'FC005', 30, 'X004', 'S005', '30-06-2020', 100, 77);
INSERT INTO BOLTSTOCK VALUES ('BC302', 'FC003', 20, 'X005', 'S003', '01-02-2021', 25, 249);
INSERT INTO BOLTSTOCK VALUES ('BC303', 'FC003', 30, 'X006', 'S003', '10-10-2021', 31, 300);

